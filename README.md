# FastShadow

实现了一种基于密钥派生的多轮区块链隐蔽通信方案，区块链采用比特币，使用btcd与btcwallet与比特币进行交互

首先采用多轮传输实现了在用户代币有限的情况下对于秘密消息的传输，其次本方案将秘密消息嵌入交易签名随机数中，基于密钥派生的方法实现交易的批量嵌入，相比于现有方案大大减少了额外辅助交易的数量，并且提高了秘密消息的提取效率

- Crypto：加密、哈希相关操作
- EmbedMsg：消息嵌入
- ExtractMsg：消息提取
- Transaction：比特币交易操作：生成交易、签名交易、广播交易等
- Key：密钥相关操作：生成密钥、派生密钥、密钥格式转换（wif）、密钥转换为地址、密钥序列化等
- RPC：建立btcd连接
- Transfer：初始化转账操作

## 系统模型

<img width="953" height="473" alt="image" src="https://github.com/user-attachments/assets/7bbcddbb-73ee-4b07-93d2-168a4b47f2f2" />


## 主要步骤
初始化阶段：
1.	在通信开始之前，发送方本地生成一对根密钥和一个辅助随机数，然后通过链外通道与接收方共享根公钥和辅助随机数。

消息嵌入阶段：

2.	添加一个结束标志到秘密消息并将消息按照256比特分割
3.	发送方根据交易分配策略计算秘密消息所需的传输轮数以及每轮传输发送的交易个数
4.	发送方根据隐蔽交易的分配方案派生主私钥以及通信私钥
5.	根据概率函数发送金额混淆交易对交易金额进行混淆
6.	将代币从银行地址转移到缺少代币的发送地址
7.	使用通信私钥构建隐蔽交易，然后将消息段嵌入签名随机数
8.	发送隐蔽交易
9.	将剩余代币从发送地址转移到银行地址
10.	等待本轮所有交易在区块链上被确认，然后发送一个辅助交易与接收者共享主私钥
重复2-10直到发送完秘密消息。

消息提取阶段：

11.	接收方根据预共享的根公钥派生主公钥
12.	接收方根据主公钥的地址从区块链上过滤辅助交易
13.	根据预共享的提取随机数从提取交易中提取主私钥
14.	通过主私钥派生通信私钥
15.	根据通信私钥的地址从区块链上过滤隐蔽交易
16.	根据主私钥从隐蔽交易中提取随机数也就是秘密消息
重复11-15直到提取出包含结束标志的秘密消息
